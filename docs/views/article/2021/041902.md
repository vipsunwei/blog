---
title: vue/cli4 é¡¹ç›®è¿ç§»åˆ° Vite2.0ï¼ˆvue3 + element-plusï¼‰
date: 2021-04-19 20:00:00
tags:
  - Vite
  - vue3
categories:
  - article
sidebar: "auto"
---

:::tip

ä½¿ç”¨ `Vite` å¼€å‘é˜¶æ®µå°±æ˜¯çˆ½ï¼Œä¸€ä¸ªå­—ï¼š**å¿«**ï¼

æ­¤æ–‡è®°å½•äº†æˆ‘è¿ç§»é¡¹ç›®æ—¶ç¢°åˆ°çš„ä¸€äº›é—®é¢˜å’Œæˆ‘è§£å†³é—®é¢˜çš„åŠæ³•ã€‚

:::

<!-- more -->

## å…ˆåˆ›å»ºä¸€ä¸ª vite é¡¹ç›®

> æ³¨æ„ï¼švite éœ€è¦ node.js ç‰ˆæœ¬ >= 12.0.0

ä½¿ç”¨ `NPM`:

```shell
npm init @vitejs/app
```

ä½¿ç”¨ `Yarn`:

```shell
yarn create @vitejs/app
```

ç„¶åæŒ‰ç…§æç¤ºæ“ä½œå³å¯ï¼

## è¿ç§»é¡¹ç›®ä»£ç 

æŠŠ `vue-cli4` çš„é¡¹ç›®ä¸­çš„ `src` æ–‡ä»¶å¤¹ï¼Œæ•´ä¸ªå¤åˆ¶åˆ° `vite` åˆ›å»ºçš„é¡¹ç›®ä¸­ï¼Œç›´æ¥æ›¿æ¢æ‰`vite` é¡¹ç›®ä¸­ç”Ÿæˆçš„ `src` æ–‡ä»¶å¤¹ã€‚

## å®‰è£…é¡¹ç›®ä¾èµ–

### å®‰è£… dependencies

æŠŠ `vue-cli` åˆ›å»ºçš„é¡¹ç›® `package.json` æ–‡ä»¶ä¸­çš„`dependencies`å¤åˆ¶åˆ° `vite` æ–°åˆ›å»ºçš„é¡¹ç›®çš„ `package.json` æ–‡ä»¶ä¸­

å˜æˆäº†è¿™æ ·ï¼š

```json
{
  "dependencies": {
    "axios": "^0.21.1",
    "element-plus": "^1.0.2-beta.40",
    "lodash-es": "^4.17.21",
    "mitt": "^2.1.0",
    "vue": "^3.0.11",
    "vue-router": "^4.0.6",
    "vuex": "^4.0.0"
  }
}
```

æ‰“å¼€ç»ˆç«¯æ‰§è¡Œå®‰è£…å‘½ä»¤

ä½¿ç”¨ `Yarn`

```bash
yarn
```

ä½¿ç”¨ `NPM`

```shell
npm install
```

å¯åŠ¨å¼€å‘æœåŠ¡å™¨è¯•è¯•

```bash
yarn dev
æˆ–è€…
npm run dev
```

### å®‰è£… devDependencies

æŠ¥é”™æç¤ºï¼šæ‰¾ä¸åˆ° `sass`ï¼Œéœ€è¦å®‰è£…`sass`åŒ…

```bash
yarn add sass --dev
æˆ–è€…
npm i sass -D
```

è£…å®Œå°±å¥½äº†ï¼Œå•¥ä¹Ÿæ²¡é…ç½®

```json
{
  "devDependencies": {
    "@vitejs/plugin-vue": "^1.2.1",
    "@vue/compiler-sfc": "^3.0.5",
    "sass": "^1.32.8",
    "vite": "^2.1.5"
  }
}
```

æŒ‰ç…§æŠ¥é”™ä¿¡æ¯ï¼Œç¼ºå•¥å°±å®‰è£…å•¥ï¼Œä¸è¦ä¸€è‚¡è„‘çš„æŠŠ `webpack` ä¹‹å‰ä¾èµ–çš„é‚£äº›å¼€å‘å·¥å…·åŒ…å…¨éƒ½æ‹¿è¿‡æ¥å®‰è£…ã€‚

### ä½¿ç”¨ `CDN` å¼•å…¥é `ESM` çš„ä¾èµ–åŒ…

å¦‚æœå‘ç°æœ‰çš„ä¾èµ–å¼•å…¥åæŠ¥é”™ï¼Œé‚£ä¹ˆå¯èƒ½æ˜¯è¿™ä¸ªä¾èµ–ä¸­æœ‰ä¸ç¬¦åˆ `ESM` çš„åœ°æ–¹ï¼Œæˆ‘çš„é¡¹ç›®é‡Œæœ‰ç”¨åˆ°ä¸€ä¸ªå·¥å…· `vertx3-eventbus-client` è¿™ä¸ªåŒ…å°±ä¸æ˜¯ `ES Module` çš„ï¼ŒæŠ¥é”™è¯´ `global` æœªå®šä¹‰ï¼Œè€Œæˆ‘çš„ä»£ç ä¸­æ²¡æœ‰å†™ä»€ä¹ˆ `global`ï¼Œçœ‹è°ƒç”¨æ ˆæ˜¯è¿™ä¸ªåŒ…å¼•èµ·çš„ï¼Œæ²¡æ‰¾åˆ°å…¶ä»–è§£å†³åŠæ³•ï¼Œæœ€åé€‰æ‹©äº†ç›´æ¥åœ¨`index.html`ä¸­ä»¥ `CDN` çš„æ–¹å¼å¼•å…¥è¿™ä¸ªåŒ…

```html
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@vertx/eventbus-bridge-client.js@1/vertx-eventbus.min.js"></script>
```

æœç´¢ `CDN` åœ°å€çš„æ—¶å€™å‘ç° `vertx3-eventbus-client` è¿™ä¸ªåŒ…å·²ç»è¢«å¼ƒç”¨äº†ï¼Œå®˜æ–¹æ¨èæ›´æ¢åˆ°`@vertx/eventbus-bridge-client`ï¼Œæ‰€ä»¥å°±æ˜¯ä¸Šè¾¹å¼•å…¥çš„æ–°åœ°å€ã€‚

æ¥ä¸‹æ¥å°±æ˜¯å¯¹ç…§ç»ˆç«¯ä¸­çš„æŠ¥é”™å’Œæµè§ˆå™¨æ§åˆ¶å°ä¸­çš„æŠ¥é”™ï¼Œè§£å†³è¿™äº›æŠ¥é”™é—®é¢˜ã€‚

## è§£å†³æŠ¥é”™

### è·¯å¾„åˆ«åé—®é¢˜ï¼š

åŸé¡¹ç›®ä¸­æœ‰äº›åœ°æ–¹ç”¨äº† `@` ä½œä¸º `src` çš„åˆ«åï¼Œæˆ‘ä»¬æ‰“å¼€ `vite.config.js` é…ç½®æ–‡ä»¶é…ç½®ä¸€ä¸‹ï¼š

```js
import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";
import { resolve } from "path";

export default defineConfig({
  plugins: [vue()],
  // å¢åŠ è·¯å¾„åˆ«å
  resolve: {
    alias: {
      "@": resolve(process.cwd(), "src"),
    },
  },
});
```

### ç¯å¢ƒå˜é‡é—®é¢˜ï¼š

åŸé¡¹ç›®ä¸­ç”¨äº†`.env.development` å’Œ`.env.production` æ¥å®šä¹‰çš„ï¼Œç„¶ååœ¨å°è£…æ¥å£ api çš„åœ°æ–¹ `process.env.VUE_APP_HOST` è¿™æ ·æ¥ä½¿ç”¨çš„ï¼Œ`vite` é¡¹ç›®ä¸­ä¼šæŠ¥é”™ `process` ä¸èƒ½ç”¨äº†ï¼Œå®˜ç½‘è¯´çš„ `import.meta.env` è¿™é‡Œè¾¹æœ‰å†…å»ºå˜é‡ï¼Œä¹Ÿæœ‰ä½ å®šä¹‰çš„é¢å¤–ç¯å¢ƒå˜é‡ï¼Œè‡ªå·±æ‰“å°å‡ºæ¥çœ‹çœ‹å°±çŸ¥é“æ€ä¹ˆç”¨äº†ï¼Œ

#### `.env` æ–‡ä»¶

`vite` ä½¿ç”¨ `dotenv` åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹ä»ä»¥ä¸‹æ–‡ä»¶åŠ è½½é¢å¤–çš„ç¯å¢ƒå˜é‡ï¼š

```bash
.env              # æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¼šåŠ è½½
.env.local        # æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¼šåŠ è½½ï¼Œä½†ä¼šè¢« git å¿½ç•¥
.env.[mode]       # åªåœ¨æŒ‡å®šæ¨¡å¼ä¸‹åŠ è½½
.env.[mode].local # åªåœ¨æŒ‡å®šæ¨¡å¼ä¸‹åŠ è½½ï¼Œ ä½†ä¼šè¢« git å¿½ç•¥
```

åŠ è½½çš„ç¯å¢ƒå˜é‡ä¹Ÿä¼šé€šè¿‡ `import.meta.env` æš´éœ²ç»™å®¢æˆ·ç«¯æºç ã€‚

ä¸ºäº†é˜²æ­¢æ„å¤–åœ°å°†ä¸€äº›ç¯å¢ƒå˜é‡æ³„æ¼åˆ°å®¢æˆ·ç«¯ï¼Œåªæœ‰ä»¥ `VITE_` ä¸ºå‰ç¼€çš„å˜é‡æ‰ä¼šæš´éœ²ç»™ç»è¿‡ `vite` å¤„ç†çš„ä»£ç ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š

```bash
DB_PASSWORD=foobar
VITE_SOME_KEY=123
```

åªæœ‰ `VITE_SOME_KEY` ä¼šè¢«æš´éœ²ä¸º `import.meta.env.VITE_SOME_KEY` æä¾›ç»™å®¢æˆ·ç«¯æºç ï¼Œè€Œ `DB_PASSWORD` åˆ™ä¸ä¼šã€‚

> æ³¨æ„ï¼šå›ºå®šçš„å‰ç¼€ VITE\_ æ‰ä¼šè¢«æš´éœ²

> å®‰å…¨è­¦å‘Šï¼š
> .env.\*.local æ–‡ä»¶åº”æ˜¯æœ¬åœ°çš„ï¼Œå¯ä»¥åŒ…å«æ•æ„Ÿå˜é‡ã€‚ä½ åº”è¯¥åŠ ä¸Š .local åˆ°ä½ çš„ .gitignore ä»¥é¿å…ä»–ä»¬è¢«æ£€å‡ºåˆ° gitã€‚
>
> ç”±äºæš´éœ²åœ¨ Vite æºç ä¸­çš„ä»»ä½•å˜é‡éƒ½å°†æœ€ç»ˆå‡ºç°åœ¨å®¢æˆ·ç«¯åŒ…ä¸­ï¼ŒVITE\_\* å˜é‡åº”è¯¥ä¸åŒ…å«ä»»ä½•æ•æ„Ÿä¿¡æ¯ã€‚

å°†åŸæ¥ `VUE_APP_` å¼€å¤´çš„å…¨éƒ½æ”¹æˆ `VITE_` å°±è¡Œäº†ã€‚

å¦‚æœä¸ä½¿ç”¨`.env` æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨ `vite.config.js` é…ç½®æ–‡ä»¶ä¸­å®šä¹‰å¸¸é‡

```json
import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";
import { resolve } from "path";

export default defineConfig({
  plugins: [vue()],
  // å¢åŠ è·¯å¾„åˆ«å
  resolve: {
    alias: {
      "@": resolve(process.cwd(), "src"),
    },
  },
  // å¢åŠ å®šä¹‰å¸¸é‡
  define: {
    HOST: JSON.stringify("http://api.test.com:8000"),
    EVENTBUS_HOST: JSON.stringify("http://api.test.com:8001")
  }
})
```

ä¸€èˆ¬ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œæœ€å¥½é‡æ–°å¯åŠ¨ä¸€ä¸‹é¡¹ç›®ã€‚

è¿™ç§å®šä¹‰æ–¹å¼åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„è¯å°±ä¸éœ€è¦ `import.meta.env` å†™è¿™ä¹ˆé•¿ä¸€ä¸²äº†ï¼Œç›´æ¥å†™ `HOST` å°±è¡Œäº†ã€‚

```js
import axios from "axios";
// @vue/cli4 é¡¹ç›®ä¸­çš„æ–¹å¼
// const host = process.env.VUE_APP_HOST;
// .env æ–‡ä»¶çš„æ–¹å¼
const host = import.meta.env.VITE_HOST;
// vite.config.js æ–‡ä»¶ä¸­ä½¿ç”¨ define å®šä¹‰å¸¸é‡çš„æ–¹å¼
// const host = HOST;

const request = axios.create({
  baseURL: host,
  timeout: 30 * 1000,
});

export default request;
```

### æ‰¹é‡å¯¼å…¥

æˆ‘é¡¹ç›®ä¸­æœ‰ä¸€äº› `MP3` æ–‡ä»¶éœ€è¦æ‰¹é‡å¯¼å…¥ï¼Œåšæˆ `object` çš„æ•°æ®å½¢å¼ä½¿ç”¨ï¼ŒåŸæ¥ç”¨çš„ `require.context` ï¼Œè¿ç§»åˆ° `Vite` è¿™é‡Œä¸æ”¯æŒäº†ã€‚

```js
// index.js
// æˆ‘è¿™ä¸ªå…¥å£æ–‡ä»¶å’ŒMP3æ–‡ä»¶åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ï¼Œæ‰€ä»¥ç›´æ¥ä»å½“å‰ç›®å½•å¯¼å…¥MP3ç»“å°¾çš„æ–‡ä»¶ï¼Œä¸ä¼šåŒ¹é…åˆ°å…¥å£index.jsæ–‡ä»¶

// åŸé¡¹ç›®å†™æ³•
// const files = require.context(".", false, /.mp3$/);
// const steps = files.keys().reduce((obj, path) => {
//   const name = path.replace(/^\.\/æ­¥åºæ”¹å˜ç»´(.*)\.mp3/, "$1");
//   obj[name] = files(path);
//   return obj;
// }, {});

// viteé¡¹ç›®å†™æ³•
const files = import.meta.globEager("./*.mp3");

const steps = Object.keys(files).reduce((obj, item) => {
  // åŒ¹é…å‡ºä¸€æ®µè‡ªå·±æƒ³è¦çš„å­—ç¬¦ä¸²ä½œä¸ºå¯¹è±¡çš„å±æ€§åï¼Œå¯ä»¥æ˜¯ä¸­æ–‡çš„ï¼Œæ²¡æ¯›ç—…
  // å±æ€§å€¼å°±æ˜¯è¿™ä¸ªMP3æ–‡ä»¶çš„urläº†
  const key = item.replace(/^\.\/æ­¥åºæ”¹å˜ç»´(.*)\.mp3$/, "$1");
  obj[key] = files[item].default;
  return obj;
}, {});

export default steps;
```

### è§£å†³ require æŠ¥é”™

å°è£…æ¥å£çš„ `api` æ–‡ä»¶ä¸­ï¼Œæ¥å£æ–¹æ³•é‡Œä½¿ç”¨äº† `require` å¯¼å…¥å‡æ•°æ®æ–‡ä»¶ï¼Œ`Vite` è¿™é‡Œä½¿ç”¨`import` ä¸¤ç§æ–¹å¼: **é™æ€å¯¼å…¥**å’Œ**åŠ¨æ€å¯¼å…¥**ä¸‹è¾¹åˆ†åˆ«ç»™å‡ºç¤ºä¾‹ï¼š

```js
// å‡æ•°æ® tkyinfo.js
const data = {
  key: "value",
  // ...
};
export default { data, status: 200 };
```

å¯¼å…¥éœ€è¦çš„å‡æ•°æ®

```js
// å°è£…api
import { getToken } from "../utils/auth.js";

// åŸé¡¹ç›®requireçš„å†™æ³•
// export const getTkyInfoByFQTime = (st, et) => {
//   return Promise.resolve(require("../data/tkyinfo.js").default.data);
// };

// é™æ€å¯¼å…¥æ–¹å¼
import tkyinfo from "../data/tkyinfo.js";
export const getTkyInfoByFQTime = (st, et) => {
  return Promise.resolve(tkyinfo.data);
};

// åŠ¨æ€å¯¼å…¥æ–¹å¼
export const getTkyInfoByFQTime = async (st, et) => {
  const tkyinfo = await import("../data/tkyinfo.js");
  return Promise.resolve(tkyinfo.default.data);
};
```

ä¸å¸¦ `default` çš„æ¨¡å—å¯¼å‡ºæ–¹å¼

```js
// å‡æ•°æ® tkyidarr.js
export const tkyIdArr = [
  { id: "a3ne8f3" },
  // ...
];
```

å¯¼å…¥ä¸å¸¦ `default` çš„æ¨¡å—ä¸­æ•°æ®

```js
// å°è£…api
import { getToken } from "../utils/auth.js";

// åŸé¡¹ç›®å†™æ³•
// export function getTkyInfoByJCTime(st, et) {
//   return Promise.resolve(require("../data/tkyidarr.js").tkyidarr);
// }

// é™æ€å¯¼å…¥æ–¹å¼
import { tkyIdArr } from "tkyidarr.js";
export function getTkyInfoByJCTime(st, et) {
  return Promise.resolve(tkyIdArr);
}

// åŠ¨æ€å¯¼å…¥æ–¹å¼
export async function getTkyInfoByJCTime(st, et) {
  const result = await import("../data/tkyidarr.js");
  return Promise.resolve(result.tkyIdArr);
}
```

## ä½¿ç”¨æŒ‰éœ€å¼•å…¥æ’ä»¶å¯¼å…¥ element-plus

### å®‰è£…æ’ä»¶

```bash
yarn add vite-plugin-style-import --dev
æˆ–è€…
npm i vite-plugin-style-import -D
```

```json
{
  "devDependencies": {
    "@vitejs/plugin-vue": "^1.2.1",
    "@vue/compiler-sfc": "^3.0.5",
    "sass": "^1.32.8",
    "vite": "^2.1.5",
    "vite-plugin-style-import": "^0.9.2"
  }
}
```

### ä¿®æ”¹ vite.config.js

```js
import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";
// å¯¼å…¥æ’ä»¶
import styleImport from "vite-plugin-style-import";
import { resolve } from "path";

// https://vitejs.dev/config/
export default defineConfig({
  // åœ¨pluginsä¸­å¢åŠ è¿™ä¸ªæ’ä»¶çš„é…ç½®, å¦‚æœä½ æƒ³ä½¿ç”¨sassï¼Œå¯ä»¥å»element-pluså®˜æ–¹æ–‡æ¡£å¿«é€Ÿä¸Šæ‰‹ä¸­ï¼Œå¾€ä¸‹ç¿»åˆ°viteéƒ¨åˆ†æŸ¥çœ‹å…·ä½“é…ç½®
  plugins: [
    vue(),
    styleImport({
      libs: [
        {
          libraryName: "element-plus",
          esModule: true,
          ensureStyleFile: true,
          resolveStyle: (name) => {
            return `element-plus/lib/theme-chalk/${name}.css`;
          },
          resolveComponent: (name) => {
            return `element-plus/lib/${name}`;
          },
        },
      ],
    }),
  ],
  resolve: {
    alias: {
      "@": resolve(process.cwd(), "src"),
    },
  },
  define: {
    HOST: JSON.stringify("http://api.test.com:8000"),
    EVENTBUS_HOST: JSON.stringify("http://api.test.com:8001"),
  },
});
```

### æ³¨å†Œä½ è¦ä½¿ç”¨çš„ element-plus ç»„ä»¶

#### æ³¨å†Œæˆå…¨å±€ç»„ä»¶

æˆ‘æ˜¯åœ¨ä¸€ä¸ªå•ç‹¬çš„ `js` æ–‡ä»¶åšçš„ç»„ä»¶å¯¼å…¥å’Œæ³¨å†Œï¼Œè¿™æ–‡ä»¶åå­—è‡ªå®šä¹‰ï¼Œéšä¾¿å•¦ã€‚

```js
// element-ui.js
import {
  ElContainer,
  ElAside,
  ElMain,
  ElMenu,
  ElMenuItem,
  ElTable,
  ElTableColumn,
  ElDatePicker,
  // ...ä¸€äº›ä½ ç”¨åˆ°çš„ç»„ä»¶
} from "element-plus";

const components = [
  ElContainer,
  ElHeader,
  ElAside,
  ElMain,
  ElMenu,
  ElMenuItem,
  ElTable,
  ElTableColumn,
  ElDatePicker,
  // ...ä¸€äº›ä½ ç”¨åˆ°çš„ç»„ä»¶
];

const plugins = [ElLoading];

// å¯¼å‡ºäº†ä¸€ä¸ªvueæ’ä»¶
export default {
  install: function(app) {
    components.map((component) => {
      app.component(component.name, component);
    });
    plugins.map((plugin) => {
      app.use(plugin);
    });
  },
};
```

åœ¨ `main.js` ä¸­å¯¼å…¥ `element-ui.js`

```js
import { createApp } from "vue";

import App from "./App.vue";
// å¯¼å…¥è‡ªå·±å†™å¥½çš„æ’ä»¶
import ElementPlus from "./element-ui.js";

const app = createApp(App);
// ä½¿ç”¨è‡ªå·±å†™çš„æ’ä»¶
app.use(ElementPlus);

app.mount("#app");
```

å‘ç° `icon` å›¾æ ‡ä¸æ˜¾ç¤ºäº†ï¼Œåœ¨ `element-ui.js` ä¸­å¢åŠ å¼•å…¥`ElIcon`ç»„ä»¶å°±å¥½äº†ã€‚

```js
// element-ui.js
import {
  // å¯¼å…¥ElIconç»„ä»¶
  ElIcon,
  ElContainer,
  ElAside,
  ElMain,
  ElMenu,
  ElMenuItem,
  ElTable,
  ElTableColumn,
  ElDatePicker,
  // ...ä¸€äº›ä½ ç”¨åˆ°çš„ç»„ä»¶
} from "element-plus";

const components = [
  // éœ€è¦å¯¼å…¥ElIconç»„ä»¶
  ElIcon,
  ElContainer,
  ElHeader,
  ElAside,
  ElMain,
  ElMenu,
  ElMenuItem,
  ElTable,
  ElTableColumn,
  ElDatePicker,
  // ...ä¸€äº›ä½ ç”¨åˆ°çš„ç»„ä»¶
];

const plugins = [ElLoading];

export default {
  install: function(app) {
    components.map((component) => {
      app.component(component.name, component);
    });
    plugins.map((plugin) => {
      app.use(plugin);
    });
  },
};
```

### å›½é™…åŒ–

è®¾ç½® `element-plus` ç»„ä»¶è¯­è¨€ä¸ºä¸­æ–‡

```js
// main.js
import lang from "element-plus/lib/locale/lang/zh-cn";
import { locale } from "element-plus";
import "dayjs/locale/zh-cn";
locale(lang);
```

è¿™ä¸ªé…ç½®åœ¨å¼€å‘ç¯å¢ƒä¸‹æ­£ç¡®æ˜¾ç¤ºä¸ºä¸­æ–‡äº† ğŸ˜„ï¼Œæ‰“åŒ…ä¹‹åå´è¿è¡ŒæŠ¥é”™ ğŸ˜­ï¼Œè¿é¦–é¡µéƒ½å‡ºä¸æ¥ï¼Œç¿»äº†å¥½ä¹… `element-plus` æ–‡æ¡£ï¼Œååå¤å¤ ğŸ˜© çš„æ”¹é…ç½®è¯•éªŒï¼Œæ‰¾åˆ°ä¸€ä¸ªæ‰“åŒ…ä¹‹åå¯ä»¥æ­£å¸¸è¿è¡Œå¹¶ä¸”è®¾ç½®ä¸­æ–‡æˆåŠŸçš„æ–¹æ¡ˆ

```js
// è®¾ç½®ä¸­æ–‡
// build ç”Ÿæ•ˆï¼›
// dev ä¸ç”Ÿæ•ˆï¼›
// ä¸è¿‡è¿™ä¸é‡è¦ï¼Œæˆ‘è¦çš„æ˜¯æ‰“åŒ…ä¹‹åæ˜¯æ­£å¸¸çš„å°±OKï¼ï¼ï¼
import lang from "element-plus/lib/locale/lang/zh-cn";
import locale from "element-plus/lib/locale";
import "dayjs/locale/zh-cn";
locale.use(lang);
```

ç›®å‰æˆ‘åªè¯•å‡ºæ¥è¿™ä¸ªåŠæ³•ï¼Œæˆ–è®¸éœ€è¦åœ¨ `vite.config.js` ä¸­å¯¹æ‰“åŒ…åšäº›ä»€ä¹ˆé…ç½®ï¼Œæˆ–è€…åˆ«çš„æ–¹æ³•ï¼Œæˆ‘ç°åœ¨è¿˜ä¸çŸ¥é“ï¼Œä¹Ÿæ²¡æœ‰ç»§ç»­å»ç ”ç©¶ã€‚

è®¾ç½®å…¨å±€ `size` å’Œ `zIndex`

```js
// æŒ‰éœ€å¼•å…¥æ—¶ï¼Œè®¾ç½®å…¨å±€sizeå’Œz-indexçš„æ–¹æ³•ï¼ŒzIndexé»˜è®¤ï¼š2000
app.config.globalProperties.$ELEMENT = { size: "small", zIndex: 3000 };
```

## æ‰“åŒ…çš„ä¸€äº›é…ç½®

### å°†æ‰“åŒ…åçš„æ–‡ä»¶æŒ‰ç±»å‹è¾“å‡ºåˆ°ä¸åŒçš„æ–‡ä»¶å¤¹

é»˜è®¤æ˜¯å¹³é“ºåœ¨ `assets` æ–‡ä»¶å¤¹ä¸­çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹`vite.config.js`æŠŠ `css`ã€`js` åˆ†åˆ«è¾“å‡ºåˆ°å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸­

```js
// vite.config.js
import { defineConfig } from "vite";
module.exports = defineConfig({
  // ... å…¶å®ƒé…ç½®é¡¹

  build: {
    assetsDir: "assets", // å­—ä½“ã€å›¾ç‰‡ã€éŸ³é¢‘ç­‰é™æ€èµ„æºé»˜è®¤å°±æ˜¯è¾“å‡ºåˆ°assetsä¸­çš„ï¼Œæ­¤é¡¹å¯ä¸å†™
    rollupOptions: {
      output: {
        assetFileNames: "css/[name].[hash].css",
        chunkFileNames: "js/[name].[hash].js",
        entryFileNames: "js/[name].[hash].js",
      },
    },
  },
});
```

### å°†ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…æ‹†åˆ†åˆ°ç‹¬ç«‹çš„ js æ–‡ä»¶

æ‰‹åŠ¨å°† `node_modules` ä¸­çš„ç¬¬ä¸‰æ–¹åŒ…æ‹†åˆ†åˆ°ç‹¬ç«‹çš„ `js` æ–‡ä»¶ï¼Œé¿å…å…¨éƒ½æ‰“åˆ° `vendor.js` ä¸­ï¼Œå¯¼è‡´æ–‡ä»¶ `size` è¿‡å¤§ï¼Œä¼šåœ¨ç»ˆç«¯æŠ¥æ€§èƒ½ä¼šæœ‰å½±å“çš„è­¦å‘Š

```js
// vite.config.js
import { defineConfig } from "vite";
module.exports = defineConfig({
  // ... å…¶å®ƒé…ç½®é¡¹

  build: {
    assetsDir: "assets", // å­—ä½“ã€å›¾ç‰‡ã€éŸ³é¢‘ç­‰é™æ€èµ„æºé»˜è®¤å°±æ˜¯è¾“å‡ºåˆ°assetsä¸­çš„ï¼Œæ­¤é¡¹å¯ä¸å†™
    rollupOptions: {
      output: {
        assetFileNames: "css/[name].[hash].css",
        chunkFileNames: "js/[name].[hash].js",
        entryFileNames: "js/[name].[hash].js",
        // æ­¤å¤„æ‰‹åŠ¨è®¾ç½®ï¼Œå°†é¡¹ç›®ä¾èµ–çš„ç¬¬ä¸‰æ–¹åŒ…éƒ½æ‹†åˆ†åˆ°ç‹¬ç«‹çš„jsæ–‡ä»¶ï¼Œé¿å…vendoråŒ…sizeè¿‡å¤§ï¼Œï¼ˆä¸å–œæ¬¢çœ‹åˆ°ç»ˆç«¯çš„è­¦å‘Šï¼‰
        manualChunks: {
          "lodash-es": ["lodash-es"],
          // è¯•äº†ä¸€ä¸‹ä¼ å­—ç¬¦ä¸²ä¹Ÿæ˜¯å¯ä»¥çš„
          // "lodash-es": "lodash-es",
          "element-plus": ["element-plus"],
          axios: ["axios"],
          vuex: ["vuex"],
          "vue-router": ["vue-router"],
          mitt: ["mitt"],
          vue: ["vue"],
        },
      },
    },
  },
});
```

### å¼€å‘ç¯å¢ƒè·¨åŸŸä»£ç†é…ç½®

```js
// vite.config.js
import { defineConfig } from "vite";
module.exports = defineConfig({
  // ... å…¶å®ƒé…ç½®é¡¹

  server: {
    proxy: {
      "^/api/.*": {
        target: "https://...",
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, ""),
      },
    },
  },
});
```
